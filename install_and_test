#!/bin/sh

make clean;
make;
sudo make install;

psql <<EOF
	SET jit=on;
	SET work_mem="1GB";
	DROP EXTENSION repeat;
	CREATE EXTENSION repeat;

	\timing
	\echo ValuePerCall
	SELECT * FROM repeat_valuepercall(7,7);
	\echo Materialize
	SELECT * FROM repeat_materialize(7,7);
	\echo
	\echo
	
	\echo ValuePerCall
	SELECT count(*) FROM (SELECT * FROM repeat_valuepercall(7,10000000)) s;
	\echo
	\echo

	\echo Materialize
	SELECT count(*) FROM (SELECT * FROM repeat_materialize(7,10000000)) s;
	\echo
	\echo
EOF
